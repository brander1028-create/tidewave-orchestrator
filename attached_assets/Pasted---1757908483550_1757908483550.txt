[업데이트 요청] 결과 요약 카드 + 자세히 보기 + 히스토리/로그 페이지 (기존 흐름 유지)

■ 두 줄 요약
- 입력 키워드(예: 홍삼, 비타민, 인삼)별로 “요약 카드” 1장씩: 검색량, 신규/총 노출 블로그, (신규 중) Phase2 노출 블로그 수를 한눈에.
- “자세히”에서 신규 블로그 리스트와 Phase2 결과를 표로 확인(키워드별 Top 노출키워드 10개, 조회량·점수·노출순위 표시, 더보기 지원). 모든 실행 기록은 히스토리/로그 페이지에 남김.

────────────────────────────────────────────────

■ 반드시 지킬 것 (MUST)
1) **재구축 금지**
   - 기존 파일/엔드포인트/스키마 그대로. 새 마이그레이션 금지.
   - 필요 시 목록용 인덱스 엔드포인트 **1개만** 추가 가능(`GET /api/serp/runs?limit=...`) — 기존 테이블만 조회. 새 테이블 금지.

2) **Phase1/Phase2 정의(재확인)**
   - Phase1: 입력 목적 키워드로 상위/후보 블로그 수집. **이미 수집된 블로그는 재수집 스킵**(중복 방지).
   - Phase2: 각 신규 블로그의 최신글 10개 제목에서 **조회량 Top4** 선출(정규화 동치·DB우선→API폴백→업데이트→재스코어).  
     ※ 원 키워드와 무관한 키워드도 **데이터**. 필터 금지, `meta.related` 라벨만.

3) **조회량 Top4 알고리즘(확정)**
   - n-gram(1~3) + 조사/불용어 제거 + 길이(2~12자) 제한.
   - 정규화 동치: NFKC+소문자, 공백/하이픈/언더스코어/점 제거 → "홍삼 스틱" ≡ "홍삼스틱".
   - DB 캐시(TTL 30d) 우선 → 미스/만료는 **API 폴백 강제**(400 분할, 429 Retry-After 백오프) → upsert → 동일 요청에서 재스코어.
   - 점수: `총점 = 0.7*볼륨(정규) + 0.3*콘텐츠점수`(상수 21 금지).  
     콘텐츠점수 = 빈도·제목내 위치·길이 가중(0~100).
   - 결과엔 `meta.related`만(저장 스키마 불변). UI에서만 `[관련X]` 표기.

────────────────────────────────────────────────

■ 새 UI — “키워드 요약 카드” (입력 키워드별 1장)
헤더: **{키워드}**  •  (검색량 {SearchAds 월간 평균, 없으면 ‘-’})
배지: 시도/성공 카운터(기존)  
KPI 한 줄:
- **신규 노출 블로그**: `{new_count}/{total_count}`  
  (설명: total_count=이번 Phase1에서 SERP로 포착된 블로그 수(중복 제거 후), new_count=**영구 수집 목록에 처음 등록되는 블로그** 수. 기존 보유 블로그는 수집 스킵)
- **Phase2 노출(신규)**: `{phase2_exposed_new}/{new_count}`  
  (설명: 신규 블로그 중 Phase2에서 Top4 중 하나라도 1페이지 노출되는 블로그 수)
- (선택) **Phase2 노출(전체)**: `{phase2_exposed_all}/{total_count}` (표시만, 재수집 스킵 블로그는 기존 데이터로 집계)

버튼: **자세히**(토글) · **외부 링크**(해당 키워드 m.naver.com 검색 새창)

────────────────────────────────────────────────

■ “자세히” 펼침 내용(두 섹션)
A) **① 신규 블로그(New)** — 리스트(최대 50, 더보기)  
   컬럼: [블로그명(새창) | 스캔 포스트수 | 발견경로/사유 | 최초수집일]  
   - 블로그명: 도메인/닉네임 + ↗ 아이콘(새창)  
   - 스캔 포스트수: 이번 실행에서 실제 수집·분석한 게시물 수(최대 10)  
   - 발견경로/사유: “지정키워드 1위”, “모바일 1p” 등 기존 사유 필드 재사용

B) **② Phase2 블로그(신규만)** — 표(기본 10행, 더보기 버튼)  
   컬럼: [블로그명(새창) | **노출 키워드(조회량/점수/순위)** Top10 | 비고]  
   - “노출 키워드” 칩 나열 규칙:  
     • 정렬 = (조회량 정규화 70 + 점수 30) 내림차순  
     • 각 칩 형식 = `키워드 [관련X옵션] (볼륨) (점수) (순위)`  
       예) `홍삼스틱 (39,840) (86pts) (모바일 1p #3)` / `유산균 보관 [관련X] (12,300) (74pts) (미노출)`  
     • 기본 **10개만** 보여주고 “더보기” 클릭 시 10개씩 추가

정렬 고정: 상단 카드 순서는 **Phase2 노출(신규) 비율** 내림차순 → 동률 시 신규 블로그 수 내림차순.

모바일/데스크톱 구분: 순위 텍스트에 `모바일/PC` 명시(가능하면 아이콘).

────────────────────────────────────────────────

■ 히스토리 & 로그 (새 페이지 2탭, 기존 데이터만 사용)
경로: `/history`  
Tabs: **History** | **Logs**

1) History(요약표)
   컬럼: [실행시각 | 입력키워드(콤마) | 총 블로그(신규/총) | Phase2 노출(신규) 합계 | 총 소요시간]  
   - 행 클릭 시 해당 실행의 “키워드 요약 카드들” 복기 화면으로 이동  
   - 데이터 소스: 기존 jobs/serp_runs/카운터/결과 테이블 **조회만**(스키마 변경 금지)

2) Logs(원본)
   - 실행별 구조화 로그(JSON 라인)와 요약 카운터(429 재시도 횟수, API 청크 수, 실패 키 수 등)
   - 다운로드 버튼: `.jsonl` export

(엔드포인트 참고) `GET /api/serp/runs?limit=50` 가 없다면 **최소 구현**으로 추가(기존 테이블 집계만).  
반드시 **새 테이블/마이그 없음**.

────────────────────────────────────────────────

■ 계산 규칙(카운트 정의, 중요)
- total_count: 이번 Phase1에서 키워드 K로 SERP 포착된 **고유 블로그 수**(중복 제거).  
- new_count: 위 후보 중 **영구 수집 목록(기존 discovered/collected) 기준으로 새로 등록되는** 블로그 수.  
  (구현: upsert 시 “삽입 성공”만 카운트. 테이블 스키마 변경 없이도 계산 가능)
- phase2_exposed_new: 신규 블로그 중 Phase2 Top4 키워드가 **1페이지 노출**인 블로그 수.  
- phase2_exposed_all: 전체(신규+기존) 기준 동일 정의.  
- 검색량(카드 헤더): SearchAds 월간 평균(캐시 TTL 30d, 미스는 API 폴백 후 upsert).

────────────────────────────────────────────────

■ UX 텍스트(예시)
- 카드 KPI: `신규 {new_count}/{total_count} · Phase2(신규) {phase2_exposed_new}/{new_count}`
- 칩 배지: `[관련X]` / `미노출` / `모바일 1p #N` / `PC 1p #N`
- 빈값 처리: 볼륨/순위 미확인 시 `-` 표기(0 아님)

────────────────────────────────────────────────

■ 수용 기준(체크리스트)
- 입력 키워드 3개(홍삼/비타민/인삼) 실행 시, 각 키워드 카드가 **한 화면에서 요약 KPI**를 보여줌.
- 신규/총, Phase2(신규) 수가 올바르게 집계되고, “자세히”에 **신규 블로그** & **Phase2(신규)** 표가 표시됨.
- 키워드 칩이 `키워드(볼륨)(점수)(순위)` 형식으로, **조회량70+점수30 정렬**이며 **기본 10개**만 노출→더보기 가능.
- `[관련X]` 라벨은 표시되지만 **필터링은 하지 않음**.
- 히스토리 페이지에서 실행 기록을 날짜순으로 확인 가능하고, 각 실행으로 드릴다운 됨.
- 새 마이그/스키마/대공사 **없음**. (목록 인덱스 엔드포인트 1개 추가는 허용)

────────────────────────────────────────────────

■ 참고(이미 합의된 내부 로직)
- 정규화 동치: NFKC+소문자+공백/하이픈/언더스코어/점 제거 → DB조회/API조회 모두 표면형+정규형 동시 시도.
- 429는 Retry-After 준수(최대 3회), 부분 실패여도 partial results 반환 및 counters 반영.
- 종합점수는 상수 금지, 0~100 실수치. 카드/표엔 반올림 정수(예: 86pts).
