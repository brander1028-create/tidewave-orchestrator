요청] 키워드 수집/관리 UX 간소화 & 5-지표 표시/제외 흐름 확정
변경 요약

상단의 “키워드 새로고침” 폼 제거 → [전체 키워드 가져오기] 한 버튼만 남김.

수집 규칙: 조회량 ≥ 1,000 AND 광고가능(has_ads=true) 전체 수집(merge).

목록 테이블에서 날짜 컬럼 제거 → **5지표(조회량·경쟁도·광고깊이·예상CPC·종합점수)**만 표시.

“활성화 토글” → [X] 제거로 바꾸고, 제거하면 활성 탭에서 즉시 빠지고 ‘제외된’ 탭으로 이동.

‘제외된’ 탭에서는 [↩ 복원] 누르면 다시 활성 탭으로 이동.

분석 파이프라인은 종합점수(score) 상위 3개로 제목 키워드 선택(동률 시 조회량 큰 순).

백엔드(필요 엔드포인트/규칙)

전체 수집 실행

POST /api/keywords/refresh-all

body 기본값:

{ "minVolume": 1000, "hasAdsOnly": true, "mode": "merge" }


동작: SearchAds keywordstool(showDetail=1) 배치 호출 →
raw_volume(월간합)·comp_idx/comp_score·ad_depth(has_ads)·est_cpc_krw(NULL 허용)·score 계산/업서트.
429/5xx 백오프, 30일 캐시(stale만 갱신).

목록 조회 (활성/제외)

GET /api/keywords?excluded=false&sort=score&order=desc&offset=0&limit=100

응답:

{ "items":[{ "id","text","raw_volume","comp_score","ad_depth","est_cpc_krw","score","excluded" }], "total": n }


정렬 필드: score | raw_volume | comp_score | ad_depth | est_cpc_krw (ASC/DESC)

제외/복원

PATCH /api/keywords/:id body: { "excluded": true|false }

즉시 반영(활성/제외 리스트 간 이동).

CSV

GET /api/keywords/export.csv (헤더: text,raw_volume,comp_score,ad_depth,est_cpc_krw,score,excluded)

POST /api/keywords/import?mode=replace|merge (CSV/XLSX)
필수 컬럼: text; 숫자 컬럼은 비어 있으면 0/null 처리, score는 재계산 가능.

프론트(UI) — /keywords 페이지

상단 카드 교체

기존 “기준 키워드/최대 수” 입력 폼 삭제.

버튼 1개만: [전체 키워드 가져오기] (data-testid="kw-refresh-all")

진행률/카운터 표시: requested / ok / fail + volumes_mode 배지(searchads=초록, partial=노랑, fallback=회색)

탭 구성

활성 키워드 탭(excluded=false) / 제외된 키워드 탭(excluded=true)

테이블(두 탭 공통) — 날짜 컬럼 제거

컬럼: 키워드 | 조회량(raw) | 경쟁도(comp_score) | 광고깊이(ad_depth) | 예상CPC | 종합점수(score) | 액션

정렬 버튼: 조회량/경쟁도/광고깊이/예상CPC/종합점수 각각 ASC/DESC

색상 규칙(조회량 칩/문자):

100,000↑ 빨강, 50,000~99,999 노랑, 1~49,999 초록, 0 회색

액션:

활성 탭: [X] (data-testid="kw-remove-<id>") → PATCH {excluded:true}

제외 탭: [↩] (data-testid="kw-restore-<id>") → PATCH {excluded:false}

테스트ID

kw-refresh-all, kw-summary, kw-table, kw-sort-score-desc/asc,
kw-remove-<id>, kw-restore-<id>, kw-download, kw-upload.

분석 파이프라인 반영(필수)

제목 토큰 매칭 시 **keywords(excluded=false)**에서 5지표를 함께 로드.

최종 Top3 = score DESC (동률 → raw_volume DESC).

칩/표에는 키워드 (raw_volume) + rank(없으면 0) + score 배지 표기.

수락 기준

상단에 버튼 1개만 있고, 클릭 시 전체 수집이 실행되어 진행률/카운터가 표시된다.

테이블에 날짜 없이 5지표만 보이며 정렬/제외/복원이 즉시 반영된다.

활성 ↔ 제외 이동이 정상 동작(서버 200, UI 즉시 갱신).

새 분석에서 종합점수 기준 Top3가 선택되어 결과에 표시된다.

가드(용량/부하)

API: 10개 배치 + 30일 캐시로 호출 수 제한, 429 재시도(최대 2회).

DB: 키워드 수십만도 OK(인덱스 text UNIQUE, excluded, score DESC).

volumes_mode=fallback 시 DB 캐시만 표시하고 점수는 재계산 보류(회색).