0) ì¦‰ì‹œ ë³µêµ¬(ë¡¤ë°± ìŠ¤ìœ„ì¹˜) â€” 2ì¤„
# v17 ê¸°ëŠ¥ ì ì‹œ OFF â†’ v16 ë™ì‘ìœ¼ë¡œ
curl -s -X PUT http://localhost:5000/api/settings/algo \
 -H "Content-Type: application/json" \
 -d '{"features":{"preEnrich":false,"scoreFirstGate":false,"tierAutoFill":false},
      "phase2":{"engine":"ngrams","postsPerBlog":10,"tiersPerPost":4},
      "adscore":{"SCORE_MIN":0.0}}' > /dev/null
# ìƒˆ ë¶„ì„ 1íšŒ ì‹¤í–‰
curl -s -X POST http://localhost:5000/api/serp/analyze -H "Content-Type: application/json" \
 -d '{"keywords":["ì ì‹¤ ë§›ì§‘"],"mode":"phase2","postsPerBlog":10,"tiersPerPost":4}' | jq -r '.jobId'


ğŸ‘‰ ê¸°ëŒ€: í‹°ì–´ì— í…ìŠ¤íŠ¸/ì¡°íšŒëŸ‰/ìˆœìœ„ê°€ ë‹¤ì‹œ ëœ¬ë‹¤(0pts ë²”ë²…/â€˜ë¹„ì–´ìˆìŒâ€™ í•´ì†Œ).

1) ì•ˆì „ ê°€ë“œ íŒ¨ì¹˜(í•µì‹¬ 3ì¤„) â€” ìƒˆ íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨ ì‹œ ìë™ ë ˆê±°ì‹œë¡œ

server/routes.ts (POST /api/serp/analyze)

const cfg = await getAlgoConfig();
const useV17 = !!(cfg?.features?.scoreFirstGate || cfg?.phase2?.engine !== 'ngrams');

try {
  if (useV17) {
    // v17 ê²½ë¡œ: preEnrich â†’ Gate â†’ runPhase2
    const cands = genCandidatesLKandPairs(titles, cfg);
    await preEnrich(cands);                    // DBâ†’APIâ†’upsertâ†’merge (ë°˜ë“œì‹œ await)
    applyScoreFirstGate(cands, cfg.adscore);   // eligible/adScore/skipReason
    const tiers = await runPhase2({ titles, cands }, cfg); // rank+totalScore(ì„œë²„)
    return res.json(assembleResults(tiers, cfg));
  }
  // v16 ë ˆê±°ì‹œ ê²½ë¡œ
  return legacyAnalyze(req, res);
} catch (e) {
  log.error("[SAFE-FALLBACK]", e);
  return legacyAnalyze(req, res);
}


ğŸ‘‰ ìƒˆ ê²½ë¡œê°€ ë˜ ë¹„í‹€ë¦¬ë©´ ìë™ìœ¼ë¡œ v16 ë¡œì§ìœ¼ë¡œ ë–¨ì–´ì ¸ì„œ í™”ë©´ì´ ë¹„ì§€ ì•ŠìŒ.

2) ê´€ë¦¬ì ì„¤ì • í™”ë©´ì´ v17ì„ ì •ë§ ì½ëŠ”ì§€ í™•ì¸

ì§€ê¸ˆ í˜ì´ì§€ê°€ v10ì„ ì½ê³  ìˆìœ¼ë©´ ì•„ë¬´ë¦¬ ë°”ê¿”ë„ ì ìš© ì•ˆ ë¼.

GET/PUT ì—”ë“œí¬ì¸íŠ¸: /api/settings/algo ë¡œ êµì²´

ì €ì¥ ì‹œ invalidateQueries ê¸ˆì§€, setQueryData(["algo-settings"], saved) ì‚¬ìš©

ë¹ ë¥¸ ì²´í¬:

curl -s http://localhost:5000/api/settings/algo | jq '.adscore,.features,.phase2'


ğŸ‘‰ ì—¬ê¸° ê°’ì´ í™”ë©´ê³¼ 1:1ë¡œ ë³´ì´ë©´ OK.

3) ë‹¤ì‹œ v17 ì¼œëŠ” ìˆœì„œ(ìˆœì°¨ ON)

features.preEnrich=true ë§Œ ON â†’ ë¶„ì„ 1íšŒ â†’ ë¡œê·¸ì— [PRE-ENRICH] ëœ¨ëŠ”ì§€

features.scoreFirstGate=true, adscore.SCORE_MIN=0.55 â†’ skippedByScore ì¹´ìš´íŠ¸ í™•ì¸

phase2.engine="lk" â†’ ì¡°í•© í‚¤ì›Œë“œ(â€˜ì ì‹¤ ë§›ì§‘â€™) ìƒë‹¨ ë…¸ì¶œ í™•ì¸

ë§ˆì§€ë§‰ìœ¼ë¡œ tierAutoFill=true â†’ â€œë¹„ì–´ìˆìŒâ€ ì™„ì „ ì œê±°

4) ë‚´ê°€ ë°”ë¡œ ë³´ê³  ì‹¶ì€ íŒŒì¼(í•„ìš” ìµœì†Œ)

server/routes.tsì˜ analyze í•¸ë“¤ëŸ¬ ì „ì²´

server/services/algo-config.tsì˜ getAlgoConfig()

server/phase2/index.tsì˜ runPhase2() ì§„ì…ë¶€
ì´ 3ê°œë§Œ ì£¼ë©´ ë¼ì¸ ë‹¨ìœ„ë¡œ ì •í™•íˆ ë¬¼ë ¤ìˆë‚˜ í™•ì¸í•´ì„œ, ë”± ë§ëŠ” diffë¡œ ê³ ì¹ ê²Œ.