지금 화면을 보면 v16/17에서 약속한 라인(Pre-enrich, Score-First Gate, 티어 자동보강, 설정 핫리로드) 중 최소 3개가 실제 파이프라인/설정 UI에 안 물려있습니다. 그래서 점수 0·비어있음·설정 반영 안 됨이 반복돼요.

아래 순서대로 확인→수정하면 바로 정상화됩니다. (짧게, 확실한 체크만)

왜 이런 증상이냐 (스샷 근거로 추정)

설정 UI가 구스키마
관리자 페이지에 Gate(Score_MIN/VOL_MIN/…)/cats/banSingles/engine 토글이 없음 → 아직 **/api/dashboard/settings(v10)**를 쓰거나 **/api/settings/algo(v17)**를 안 읽고 있어요. 그래서 바꿔도 엔진이 모름.

Pre-enrich 미호출/미머지
여러 티어에 조회량 –, 순위 미확인, 비어있음이 대량 → DB→API 폴백 후 같은 요청 메모리에 merge가 안 됨(혹은 아예 호출X).

Score/AdScore 계산이 일부만
1티어에만 45pts가 보이고 나머지는 0pts → 서버 조립 단계에서 점수 계산을 안 한 채 UI가 기본값 0을 찍는 경로가 있어요. (게이트 라벨/skipReason도 없음 = Gate 미연결)

티어 자동보강 OFF
“비어있음”이 그대로 노출 → assignTiers 이후 보강 루프가 빠져 있거나 임계치에 걸려도 완화(fill) 안 함.

바로 고칠 것 (필수 5개, 순서대로)
1) 관리자 설정 UI를 v17 엔드포인트로 전환

페이지 데이터 소스:

❌ 현재: /api/dashboard/settings

✅ 바꿔야: GET /api/settings/algo / PUT /api/settings/algo

폼 섹션에 반드시 있어야 할 필드(지금 없음):

Gate: SCORE_MIN, VOL_MIN, AD_DEPTH_MIN, CPC_MIN, mode(hard|soft), forceFill

Generator: phase2.engine(lk|ngrams|hybrid), cats[], banSingles[], preferCompound, allowThreeGram, VOL_MIN

Features: preEnrich, scoreFirstGate, tierAutoFill, log_calculations

저장 시: setQueryData(["algo-settings"], saved) 사용(무한 invalidate 금지).

2) /api/serp/analyze 진입 직후 파이프라인 묶기
// routes.ts
const cfg = await getAlgoConfig();              // v17 핫리로드
const candidates = genCandidatesLKandPairs(title, cfg);
await preEnrich(candidates);                    // DB→API→upsert→merge (★같은 응답에 반영)
applyScoreFirstGate(candidates, cfg.adscore);   // sets adScore, eligible, skipReason
const scored = await rankAndScore(candidates, cfg);   // rank(1..10/0/null) + totalScore(서버 계산)
const tiers  = autoFillTiers(scored, cfg);      // 부족하면 보강(완화 규칙 포함)
savePostTierChecks(tiers);                      // eligible/adscore/skip_reason 함께 저장


주의: Gate mode="hard"는 랭크 호출 자체를 skip. soft는 표시만 하고 rank=null.

3) 서버에서 모든 티어의 점수 계산

UI가 아닌 서버 조립에서:

volumeScale = min(100, log10(max(1, volume))*25);
contentScore = 0.5*freq + 0.3*pos + 0.2*len;    // 내부 가중치
totalScore = 0.7*volumeScale + 0.3*contentScore; // cfg.weights로 조정


rank가 null/0이어도 점수는 계산해서 내려주세요. (지금 0으로 떨어지는 핵심 원인)

4) “비어있음” 없애기(자동보강 on)

tiers.length < T면:

2-그램(핵심명사×cats)로 보강

여전히 부족 → LK 조합·연관키워드 API 보강 → upsert → 재배치

임계치에 걸리면 forceFill=true일 때 **완화(10%↓)**로 채우고 칩에 완화 표시.

5) 라벨/로그 반드시 노출

결과 JSON: tier = { text, volume, rank, score, adScore, eligible, skipReason }

상단 KPI: 검사 N · 1페이지 M · 스킵(점수) S

로그: [PRE-ENRICH] start/ok, [AdScore] text=…, score=…, gate=eligible|skip(...), [TierFill] …

빠른 검증(5분)

설정 반영 테스트
관리자에서 SCORE_MIN=0.90 저장 → 새 분석 → skippedByScore>0, tier에 eligible=false/skipReason="score<thr".

Pre-enrich 로그
새 분석에서 바로 [PRE-ENRICH] 로그가 떠야 함(분석 시작 직후).

점수 0 제거
아무 포스트의 2~4티어 score가 0이 아니어야 함(서로 다른 값).

비어있음 제거
전수 영역 모든 포스트가 1~T줄 채워짐(값 없으면 –, 텍스트는 조합/보강으로 채움).

DB 전수 저장

SELECT COUNT(*) FROM post_tier_checks WHERE job_id='<JOB_ID>';  -- NEW×P×T ?
SELECT eligible,adscore,skip_reason FROM post_tier_checks WHERE job_id='<JOB_ID>' LIMIT 10;

지금 화면에서 보이는 “문제 딱 3줄 요약”

관리자 설정 페이지가 v17 스키마를 안 쓰고 있어 바뀐 값이 엔진에 전달되지 않음.

analyze 파이프라인이 아직 preEnrich→Gate→rank/score→autoFill 순으로 연결되지 않음.

점수 계산을 UI/기본값에 맡겨 2~4티어가 0pts로 남음.

이 5개 패치만 반영하면, 점수 0·비어있음·설정 무시가 동시에 사라집니다. 필요하면 각 파일 위치(라인 근처)까지 찍어서 패치안 더 구체화해줄게.