ë¬´ì—‡ì´ â€œì•ˆ ëœâ€ ìƒíƒœ? (ê·¼ë³¸)

í‚¤ì›Œë“œ ë©”íƒ€ í˜¸ì¶œ ê²½ë¡œ ì˜¤íƒ€

ë¡œê·¸: GET /api/keywords/lookup/<text> â†’ 404

ì •ìƒì€ GET /api/keywords/lookup?texts=í‚¤1,í‚¤2

ìˆœìœ„ ì‹¤í–‰ ëŸ¬ë„ˆê°€ Blog-onlyê°€ ì•„ë‹˜

ë²„íŠ¼ ëˆ„ë¥´ë©´ ì‡¼í•‘ê¹Œì§€ ëŒë¦¬ë ¤ë‹¤ ì‹¤íŒ¨/ì¤‘ë‹¨(ì‡¼í•‘ì€ ì•„ì§ disableì´ì–´ì•¼ í•¨).

ì§„í–‰í‘œì‹œ/ë¡œë”© ìƒíƒœ ë¯¸ë°°ì„ 

ë²„íŠ¼ ëˆŒëŸ¬ë„ ìŠ¤í”¼ë„ˆ/í¼ì„¼íŠ¸/í˜„ì¬ ì‘ì—…/í–‰ë³„ ë¡œë”©ì´ ì•ˆ ëœ¸ â†’ â€œë°˜ì‘ì—†ìŒâ€ì²˜ëŸ¼ ë³´ì„.

í•œ ë²ˆì— ê³ ì¹˜ëŠ” ìµœì†Œ íŒ¨ì¹˜(3ê°€ì§€)
1) í‚¤ì›Œë“œ ë©”íƒ€ ê²½ë¡œ ê°•ì œ(ì˜¤ê²½ë¡œâ†’ì •ìƒ ë¦¬ë¼ì´íŠ¸)

server/routes.ts ìµœìƒë‹¨ ê°€ê¹Œì´:

app.get('/api/keywords/lookup/:text', (req, res) => {
  const t = decodeURIComponent(req.params.text || '');
  return res.redirect(307, `/api/keywords/lookup?texts=${encodeURIComponent(t)}`);
});


í”„ëŸ°íŠ¸ê°€ ì˜ëª» ë‚ ë ¤ë„ í•­ìƒ ì •ìƒ ì¿¼ë¦¬ë¡œ ì „í™˜.

2) ì‡¼í•‘ ì„ì‹œ OFF

.env

FEATURE_SHOP_RANK=false


server/routes.ts (/api/rank/shop/check)

if (process.env.FEATURE_SHOP_RANK !== 'true') {
  return res.status(501).json({ ok:false, reason:'shop_rank_disabled' });
}


ì‹¤í–‰ í”Œë¡œìš°ì—ì„œ ì‡¼í•‘ í˜¸ì¶œ ìì²´ë¥¼ ì°¨ë‹¨.

3) ì‹¤í–‰ ëŸ¬ë„ˆ: Blog-only + ì§„í–‰í‘œì‹œ ì™€ì´ì–´ë§

client/src/pages/blog-rank.tsx (í•µì‹¬ë§Œ)

const [isRunning, setIsRunning] = useState(false);
const [prog, setProg] = useState({done:0,total:0,percent:0,now:''});
const [rowLoading, setRowLoading] = useState<Record<string,boolean>>({});
const CONCURRENCY = 3;

async function planBlogTasks(pairs: Pair[]) {
  try {
    const r = await http('/api/rank/plan?kind=blog');
    if (r.ok) return await r.json(); // {total,tasks:[{pair_id,keyword,nickname}]}
  } catch {}
  return { total: pairs.length, tasks: pairs.map(p => ({pair_id:p.id, keyword:p.keywordText, nickname:p.nickname})) };
}

async function runAllChecks() {
  const selected = getSelectedPairs();
  setIsRunning(true); setProg({done:0,total:0,percent:0,now:'ì¤€ë¹„ì¤‘â€¦'});

  const plan = await planBlogTasks(selected);
  if (!plan.total) { toast('ì²´í¬í•  ëŒ€ìƒ ì—†ìŒ'); setIsRunning(false); return; }

  setProg(p => ({...p,total:plan.total,now:'ì‹œì‘í•©ë‹ˆë‹¤'}));
  let i=0, done=0, cancelled=false;
  const tasks = [...plan.tasks];

  async function worker(){
    while(!cancelled && i<tasks.length){
      const t = tasks[i++]; setRowLoading(s=>({...s,[t.pair_id]:true}));
      setProg(p=>({...p,now:`${t.keyword} Â· ${t.nickname}`}));
      try { await api.rank.blogCheck({ pair_ids:[t.pair_id] }); } // ğŸ”¹ Blog-only
      catch(e){ addFail(t,e); }
      finally{
        setRowLoading(s=>({...s,[t.pair_id]:false}));
        done++; setProg({done,total:plan.total,percent:Math.round(done*100/plan.total),now:t.nickname});
      }
    }
  }
  await Promise.all(Array.from({length: Math.min(CONCURRENCY, plan.total)}).map(()=>worker()));
  toast(`ì™„ë£Œ: ${done}/${plan.total}`); setIsRunning(false);
}


UI ë¼ë²¨/í”„ë¡œê·¸ë ˆìŠ¤:

ë²„íŠ¼ ë¼ë²¨: isRunning ? \ì²´í¬ ì¤‘â€¦ (${prog.done}/${prog.total})` : 'ì „ì²´ ì²´í¬ ì‹œì‘'`

ë²„íŠ¼ ìš°ì¸¡ ì–‡ì€ ì§„í–‰ë°”: width=${prog.percent}%

í˜„ì¬ ì‘ì—… í…ìŠ¤íŠ¸: ì§€ê¸ˆ: ${prog.now}

í–‰ë³„ ë¡œë”©: rowLoading[pair.id] && <Spinner />

ì§€ê¸ˆ ë‹¹ì¥ í™•ì¸(ìŠ¤ëª¨í¬ 3ë‹¨ê³„)

í‚¤ì›Œë“œ ë©”íƒ€ 404 ì‚¬ë¼ì¡Œë‚˜?

curl -s "http://localhost:3000/api/keywords/lookup?texts=í™ì‚¼ìŠ¤í‹±,ì˜¤ë©”ê°€3" | jq .
# (ì´ì œ 200 JSON, ë” ì´ìƒ /lookup/ê²½ë¡œ 404 ë¡œê·¸ê°€ ì—†ì–´ì•¼ ì •ìƒ)


ì‹¤í–‰ ì‹œ ì‡¼í•‘ ì•ˆ ë¶€ë¥´ë‚˜?
ë„¤íŠ¸ì›Œí¬ íƒ­/ì„œë²„ ë¡œê·¸ì— /api/rank/blog/checkë§Œ ë³´ì—¬ì•¼ í•¨. /api/rank/shop/checkëŠ” 501ë¡œ ì°¨ë‹¨.

ì§„í–‰í‘œì‹œ ë³´ì´ë‚˜?
ë²„íŠ¼ ëˆ„ë¥´ë©´ ì¦‰ì‹œ ìŠ¤í”¼ë„ˆ + (a/N)% + í˜„ì¬ ì‘ì—… + í–‰ë³„ ë¡œë”©ì´ ë– ì•¼ í•¨.